{# 
   the following KNOWL macro enables to tag certain locations in the
   HTML documents to reference to saved "Knowls". They contain all
   the information and form the stored knowledge. 
    * the knowl's title ends up in the page
    * the content is either revealed or immediately included, depends on
      what the macro does.
   The macro itself is only there for the presentation of the data via suitable
   HTML tags and associated javascript code. 
   
   Arguments: 
    * title: to overwrite the knowl's title, usually just leave it 
             to its default None.
#}
{% macro KNOWL(knowlid, title=none) -%}
  {% with knowl = Knowl(knowlid) -%}
    {% if knowl.exists() -%}
      {% if title is none -%}
         <a class="knowl-title" knowl="{{ knowl.id }}">{{ knowl.title }}</a>
      {%- else -%}
        {% if title|length > 0 -%}
         <a class="knowl-title" knowl="{{ knowl.id }}">{{ title }}</a>
        {%- endif %}
      {%- endif %}
      {# <span knowl="{{ knowl.id }}" class="knowl-qm">?</span> #}

    {%- else -%}
      {# knowl does not exist. wrong knowlid or opportunity to create one! #}
        {% if user.is_authenticated() -%}
        <span class="knowl knowl-error">
          Knowl '{{knowlid}}' missing or wrong ID. 
          <a href="{{ url_for('knowledge.edit', ID=knowlid) }}">Create it</a>.
        </span> 
        {%- else -%}
        <span class="knowl knowl-error">
          '{{knowlid}}'
        </span> 
        {%- endif %}
      </span>
    {%- endif %}
  {%- endwith %}
{%- endmacro %}

{# for the bar when editing or showing knowls #}
{% macro knowlbar() -%}
 <div class="knowl-bar">
   Actions: 
   <a title="as it will be used for transculsioins" href="{{ url_for('.render', ID=k.id) }}">render</a> 
   &middot;
   <a title="like as a wiki would" href="{{ url_for('.show', ID=k.id) }}">show</a>
   {% if user.is_authenticated() %}
     &middot;
     <a href="{{ url_for('.edit', ID=k.id) }}">edit</a>
   {% endif %}
   {% if user.is_admin() %}
     &middot;
     <a onclick='return confirm("Really delete Knowl {{ k.id }}? There is no way back!");'
            href="{{ url_for('.delete', ID=k.id) }}">delete</a>
   {% endif %}
</div>
{%- endmacro %}

